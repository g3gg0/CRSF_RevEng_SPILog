

module serial_buffer
(
   input wire reset,
   input wire clk,
	
   input wire [7:0] fifo_data,
   input wire fifo_empty,
   output wire fifo_rdreq,
	
   input wire uart_busy,
    
   output wire [7:0] out_data,
   output wire data_valid
);

reg fifo_valid = 0;
assign data_valid = !uart_busy && fifo_valid;


always @ (negedge clk)
begin
	
	if(uart_busy) begin
		fifo_valid <= 0;
	end 
	else if(!fifo_rdreq && !fifo_empty) begin
		fifo_valid <= 0;
		fifo_rdreq <= 1;
	end
	else if(fifo_rdreq) begin
		fifo_rdreq <= 0;
		fifo_valid <= 1;
	end

end

